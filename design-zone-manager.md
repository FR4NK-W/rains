# Zone manager

This document presents a design how a zone authority could manage its zone.
Always when something has to change in a current entry, an entry has to be added
or removed the zone manager handles it and makes sure that the rainsd server
gets a signed and updated assertion. The zone manager is divided into three
parts:

- actual zone manager (zoneManager)
- zone publisher (zonePub)
- rains publisher (rainsPub)

## Actual zone manager

The actual zone manager (henceforth zone manager), is responsible for managing
the zone and keeping the zone file up to date. This also includes grouping
assertions into shards, sorting the zone, and making sure that no entry violates
the protocol specification or the zone's policy. It initializes the zone
publisher and tells it in which intervals it must publish delegation assertions
for subordinate zones and the zone's own assertions. It listens for next-key
requests from the rains server and reacts to them according to its policy, i.e.
dropping, modifying or taking the next-key assertion as is.

## Zone publisher

The zone publisher periodically invokes rainsPub to push updated zone
information to the rains servers. It loads the information what to push from the
zonefile generated by the zone manager. It gets the information in which
interval to push either from a configuration, database entry or directly from
the zone manager. It calculates the signature expiration times for each
assertion and shard such that they expire evenly over the time interval defined
by the zone manager. It makes sure that the new delegation for this zone is
present on all authoritative rains servers and that the newly signed zone
information is consistent before encoding and pushing them to the rains servers.
In case one of the rains servers was not able to correctly receive a message
sent by rainsPub, the zone publisher raises an alarm.

## RAINS publisher

Is designed as a library to sign sections (assertions, shards, and zones) and to
establish connections to all authoritative servers and push the signed sections
to them. It reports back to the zone publisher in case errors have occurred.
Rainspub is not responsible for checking the validity of the sections it signs.
Currently, the private key is stored on the rainspub server but in the future an
airgapping mechanism might be used to increase security. Rainspub ignores any
information sent from the rains servers except notifications concerning a
previously pushed section from rainspub.

## Issues

- How to parallelize rainspub for large zones, especially when an airgapping
  mechanism is used.